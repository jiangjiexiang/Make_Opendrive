<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>点云在线查看器 V1.0</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>☁️</text></svg>">
    <link rel="stylesheet" href="src/css/styles.css">
</head>
<body>
    <div class="container">
        <div class="topbar">
            <h1>☁️ 点云在线查看器</h1>
            
            <!-- 点云文件加载 -->
            <div class="control-group">
                <h2>☁️</h2>
                <div class="control-content">
                    <div class="file-upload">
                        <input type="file" id="pcdFileInput" class="file-input" accept=".pcd">
                        <label for="pcdFileInput" class="file-label">选择点云文件</label>
                    </div>
                    <div class="loading" id="loadingIndicator">
                        <div class="loading-spinner"></div>
                        <span>加载中...</span>
                    </div>
                </div>
                <div class="status-info">
                    <div class="status-text" id="fileStatus">未选择文件</div>
                    <div class="status-text" id="pointCount"></div>
                </div>
            </div>

            <!-- 道路绘制 - 已隐藏 -->
            <!--
            <div class="control-group">
                <h2>🛣️</h2>
                <div class="control-content">
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                        <button id="drawButton" class="draw-button">开始画路</button>
                        <div style="width: 2px; height: 30px; background: linear-gradient(to bottom, #e2e8f0, #cbd5e0, #e2e8f0); border-radius: 1px;"></div>
                        <button id="startRoadEdit" class="draw-button" style="background: #ed8936;">编辑道路</button>
                        <button id="stopRoadEdit" class="reset-button" style="background: #a0aec0; display: none;">停止编辑</button>
                    </div>
                </div>
                <div class="status-info">
                    <div class="status-text" id="drawStatus">绘制：关闭</div>
                    <div class="status-text" id="pointsCount">点数：0</div>
                    <div class="status-text" id="drawingMode">模式：直线</div>
                </div>
            </div>
            -->

            <!-- 导出/导入 - 已隐藏 -->
            <!--
            <div class="control-group">
                <h2>💾</h2>
                <div class="control-content">
                    <button id="exportPanelButton" class="draw-button" style="background: #667eea;">导出/导入</button>
                </div>
                <div class="status-info">
                    <div class="status-text" id="savedRoadsCount">道路：0</div>
                    <div class="status-text" id="junctionsCount">交叉口：0</div>
                </div>
            </div>
            -->

            <!-- 状态信息 - 已隐藏 -->
            <!--
            <div class="control-group">
                <h2>ℹ️</h2>
                <div class="status-info">
                    <div class="status-text">ESC - 退出绘制</div>
                    <div class="status-text">Ctrl+Z - 撤销</div>
                    <div class="status-text">Space - 开始/结束</div>
                    <div class="status-text">Delete - 删除点</div>
                </div>
            </div>

            <div class="control-group">
                <h2>⌨️</h2>
                <button id="helpButton" class="help-button" title="显示快捷键帮助">?</button>
            </div>
            -->
        </div>

        <div class="main-content">
            <div id="scene-container"></div>
            
            <!-- 绘制进度条 - 已隐藏 -->
            <!--
            <div class="drawing-progress" id="drawingProgress" style="display: none; position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); z-index: 1000; background: rgba(0,0,0,0.8); padding: 15px 25px; border-radius: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                <div class="progress-bar" style="width: 200px; height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px; overflow: hidden; margin-bottom: 8px;">
                    <div class="progress-fill" id="progressFill" style="height: 100%; background: linear-gradient(90deg, #48bb78, #38a169); border-radius: 4px; transition: width 0.3s ease; width: 0%;"></div>
                </div>
                <span class="progress-text" id="progressText" style="color: white; font-size: 14px; font-weight: 500; text-align: center; display: block;">准备绘制...</span>
            </div>
            -->
            
            <!-- PCD控制面板 -->
            <div id="pcdControlsPanel" class="pcd-controls-panel">
                <div class="panel-header">📊 点云控制</div>
                
                <!-- 基本信息 -->
                <div class="control-section">
                    <h3>🗳️ 基本信息</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-item-label">总点数</div>
                            <div id="totalPoints" class="info-item-value">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-item-label">显示点数</div>
                            <div id="visiblePoints" class="info-item-value">0</div>
                        </div>
                    </div>
                </div>

                <!-- 强度过滤 -->
                <div class="control-section">
                    <h3>💡 强度过滤</h3>
                    <div class="checkbox-container">
                        <input type="checkbox" id="intensityFilterEnabled" class="checkbox">
                        <label for="intensityFilterEnabled" class="checkbox-label">启用强度过滤</label>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>最小强度</span>
                            <span id="intensityMinValue" class="slider-value">0</span>
                        </div>
                        <input type="range" id="intensityMin" class="slider" min="0" max="255" value="0" disabled>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>最大强度</span>
                            <span id="intensityMaxValue" class="slider-value">255</span>
                        </div>
                        <input type="range" id="intensityMax" class="slider" min="0" max="255" value="255" disabled>
                    </div>
                </div>

                <!-- 高度过滤 -->
                <div class="control-section">
                    <h3>📏 高度过滤</h3>
                    <div class="checkbox-container">
                        <input type="checkbox" id="heightFilterEnabled" class="checkbox">
                        <label for="heightFilterEnabled" class="checkbox-label">启用高度过滤</label>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>最小高度 (m)</span>
                            <span id="heightMinValue" class="slider-value">-10</span>
                        </div>
                        <input type="range" id="heightMin" class="slider" min="-50" max="50" value="-10" step="0.1" disabled>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>最大高度 (m)</span>
                            <span id="heightMaxValue" class="slider-value">10</span>
                        </div>
                        <input type="range" id="heightMax" class="slider" min="-50" max="50" value="10" step="0.1" disabled>
                    </div>
                </div>

                <!-- 点显示设置 -->
                <div class="control-section">
                    <h3>⚙️ 显示设置</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>点大小</span>
                            <span id="pointSizeValue" class="slider-value">2.0</span>
                        </div>
                        <input type="range" id="pointSize" class="slider" min="0.5" max="10" value="2.0" step="0.1">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>采样率 (%)</span>
                            <span id="samplingRateValue" class="slider-value">100</span>
                        </div>
                        <input type="range" id="samplingRate" class="slider" min="1" max="100" value="100">
                    </div>
                </div>

                <!-- 重置按钮 -->
                <button id="resetFilters" class="reset-button">🔄 重置所有过滤器</button>
                
                <!-- 测试按钮 -->
                <div style="margin-top: 10px;">
                    <button id="createTestPointCloud" class="reset-button" style="background: #ed8936; margin-right: 10px;">🧪 创建测试点云</button>
                    <button id="forceDisplay" class="reset-button" style="background: #48bb78; margin-right: 10px;">⚡ 强制显示</button>
                    <button id="rotatePointCloud" class="reset-button" style="background: #9f7aea;">🔄 旋转90度</button>
                </div>
            </div>
            
            <!-- 道路编辑面板 - 已隐藏 -->
            <!--
            <div id="roadEditPanel" class="pcd-controls-panel" style="top: 80px; left: 20px; display: none; position: fixed; z-index: 1000; width: 300px;">
                <div class="panel-header">✏️ 道路编辑</div>
                
                <div class="control-section">
                    <h3>📍 选中道路</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-item-label">道路ID</div>
                            <div id="selectedRoadInfo" class="info-item-value">未选择道路</div>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>⚙️ 道路参数</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <label for="editLaneWidth">车道宽度 (米)</label>
                            <span id="editLaneWidthValue">3.5m</span>
                        </div>
                        <input type="range" id="editLaneWidth" min="2.0" max="6.0" step="0.1" value="3.5" class="slider">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <label for="editLaneCount">车道数量</label>
                            <span id="editLaneCountValue">2</span>
                        </div>
                        <input type="range" id="editLaneCount" min="1" max="6" step="1" value="2" class="slider">
                    </div>
                    <div style="margin-top: 10px;">
                        <label for="editRoadType" style="display: block; margin-bottom: 5px; font-size: 12px; color: #4a5568;">道路类型</label>
                        <select id="editRoadType" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #e2e8f0;">
                            <option value="highway">高速公路</option>
                            <option value="arterial">主干道</option>
                            <option value="collector">次干道</option>
                            <option value="residential" selected>居住区道路</option>
                            <option value="service">服务道路</option>
                        </select>
                    </div>
                </div>
                
                <div class="control-section" id="curveEditControls" style="display: none;">
                    <h3>🔄 弯道调整</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <label for="editCurveRadius">弯道弧度</label>
                            <span id="editCurveRadiusValue">1.0x</span>
                        </div>
                        <input type="range" id="editCurveRadius" min="0.1" max="4.0" step="0.1" value="1.0" class="slider">
                    </div>
                    <div style="margin-top: 10px;">
                        <label for="editCurveDirection" style="display: block; margin-bottom: 5px; font-size: 12px; color: #4a5568;">弯道方向</label>
                        <select id="editCurveDirection" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #e2e8f0;">
                            <option value="auto">🔄 自动</option>
                            <option value="outward">↗️ 向外</option>
                            <option value="inward">↙️ 向内</option>
                            <option value="smooth">🌊 平滑</option>
                        </select>
                    </div>
                    <div style="margin-top: 10px;">
                        <label for="editPoint1Extension" style="display: block; margin-bottom: 5px; font-size: 12px; color: #4a5568;">点1延伸方向</label>
                        <select id="editPoint1Extension" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #e2e8f0;">
                            <option value="auto">🔄 自动</option>
                            <option value="forward">➡️ 向前</option>
                            <option value="backward">⬅️ 向后</option>
                        </select>
                    </div>
                    <div style="margin-top: 10px;">
                        <label for="editPoint2Extension" style="display: block; margin-bottom: 5px; font-size: 12px; color: #4a5568;">点2延伸方向</label>
                        <select id="editPoint2Extension" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #e2e8f0;">
                            <option value="auto">🔄 自动</option>
                            <option value="forward">➡️ 向前</option>
                            <option value="backward">⬅️ 向后</option>
                        </select>
                    </div>
                    <div class="slider-container" style="margin-top: 10px;">
                        <div class="slider-label">
                            <label for="editExtensionLength">延伸长度</label>
                            <span id="editExtensionLengthValue">0.15x</span>
                        </div>
                        <input type="range" id="editExtensionLength" min="0.05" max="0.5" step="0.05" value="0.15" class="slider">
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>🔧 操作</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <button id="applyRoadEdit" class="reset-button" style="background: #48bb78;">✅ 应用修改</button>
                        <button id="cancelRoadEdit" class="reset-button" style="background: #e53e3e;">❌ 取消编辑</button>
                    </div>
                    <div style="padding: 10px; background: #f7fafc; border-radius: 4px; font-size: 12px; color: #666;">
                        💡 点击道路进行编辑，调整参数后点击"应用修改"保存
                    </div>
                </div>
            </div>
            -->
            

            <!-- 道路控制面板 - 已隐藏 -->
            <!--
            <div id="roadControlsPanel" class="pcd-controls-panel" style="top: 80px; left: 20px; display: none; position: fixed; z-index: 1000; width: 300px;">
                <div class="panel-header">🛣️ 道路设计</div>
                
                <div class="control-section">
                    <h3>⚙️ 基本参数</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>车道宽度 (m)</span>
                            <span id="laneWidthValue" class="slider-value">3.5</span>
                        </div>
                        <input type="range" id="laneWidth" class="slider" min="2.0" max="5.0" value="3.5" step="0.1">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>车道数量</span>
                            <span id="laneCountValue" class="slider-value">2</span>
                        </div>
                        <input type="range" id="laneCount" class="slider" min="1" max="6" value="2">
                    </div>
                </div>

                <div class="control-section">
                    <h3>🎯 精度设置</h3>
                    <div class="checkbox-container">
                        <input type="checkbox" id="gridEnabled" class="checkbox">
                        <label for="gridEnabled" class="checkbox-label">启用网格吸附</label>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>网格大小 (m)</span>
                            <span id="gridSizeValue" class="slider-value">1.0</span>
                        </div>
                        <input type="range" id="gridSize" class="slider" min="0.1" max="5.0" value="1.0" step="0.1" disabled>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>点击容错 (px)</span>
                            <span id="clickToleranceValue" class="slider-value">0.5</span>
                        </div>
                        <input type="range" id="clickTolerance" class="slider" min="0.1" max="2.0" value="0.5" step="0.1">
                    </div>
                </div>

                <div class="control-section">
                    <h3>👁️ 显示设置</h3>
                    <div class="checkbox-container">
                        <input type="checkbox" id="showRoadDirections" class="checkbox" checked>
                        <label for="showRoadDirections" class="checkbox-label">显示道路方向</label>
                    </div>
                </div>

                <div class="control-section">
                    <h3>🏷️ 道路类型</h3>
                    <select id="roadType" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #e2e8f0;">
                        <option value="motorway">高速公路</option>
                        <option value="trunk">主干道</option>
                        <option value="primary">一级公路</option>
                        <option value="secondary">二级公路</option>
                        <option value="residential" selected>居住区道路</option>
                        <option value="service">服务道路</option>
                    </select>
                </div>

                <div class="control-section" id="curveParamsSection" style="display: none;">
                    <h3>🔄 弯道设置</h3>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="curveAutoConnect" checked>
                            <span>自动连接最近点</span>
                        </label>
                    </div>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="curveForceStraight">
                            <span>强制直线连接</span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <h4 style="font-size: 13px; margin-bottom: 8px; color: #4a5568;">弯道方向</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 6px; padding: 8px; background: #f7fafc; border-radius: 4px; cursor: pointer;">
                                <input type="radio" name="curveDirection" value="auto" checked>
                                <span style="font-size: 12px;">🔄 自动</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; padding: 8px; background: #f7fafc; border-radius: 4px; cursor: pointer;">
                                <input type="radio" name="curveDirection" value="outward">
                                <span style="font-size: 12px;">↗️ 向外</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; padding: 8px; background: #f7fafc; border-radius: 4px; cursor: pointer;">
                                <input type="radio" name="curveDirection" value="inward">
                                <span style="font-size: 12px;">↙️ 向内</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; padding: 8px; background: #f7fafc; border-radius: 4px; cursor: pointer;">
                                <input type="radio" name="curveDirection" value="smooth">
                                <span style="font-size: 12px;">🌊 平滑</span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 10px; background: #f7fafc; border-radius: 4px; font-size: 12px; color: #666;">
                        💡 选择弯道方向：向外（凸弯）、向内（凹弯）、平滑（S形）或自动
                    </div>
                </div>

                <div class="control-section">
                    <h3>📍 当前道路</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-item-label">控制点</div>
                            <div id="currentRoadPoints" class="info-item-value">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-item-label">长度 (m)</div>
                            <div id="currentRoadLength" class="info-item-value">0.0</div>
                        </div>
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-item-label">质量评分</div>
                            <div id="roadQualityScore" class="info-item-value">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-item-label">验证状态</div>
                            <div id="validationStatus" class="info-item-value">未验证</div>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>✅ 道路验证</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <button id="validateRoad" class="reset-button" style="background: #48bb78;">🔍 验证道路</button>
                        <button id="autoFixRoad" class="reset-button" style="background: #ed8936;">🔧 自动修复</button>
                    </div>
                    <div id="validationResults" class="validation-results" style="display: none;">
                        <div class="validation-errors" id="validationErrors"></div>
                        <div class="validation-warnings" id="validationWarnings"></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>🗂️ 已保存道路</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-item-label">道路数量</div>
                            <div id="savedRoadsCount" class="info-item-value">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-item-label">交叉口数量</div>
                            <div id="junctionsCount" class="info-item-value">0</div>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>🔧 操作</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <button id="undoAction" class="reset-button" style="background: #ed8936;">↩️ 撤销</button>
                        <button id="redoAction" class="reset-button" style="background: #48bb78;">↪️ 重做</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <button id="undoPoint" class="reset-button" style="background: #ed8936;">撤销点</button>
                        <button id="clearRoad" class="reset-button" style="background: #e53e3e;">清除</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <button id="saveRoad" class="reset-button" style="background: #48bb78;">保存道路</button>
                        <button id="createJunction" class="reset-button" style="background: #9f7aea;">创建交叉口</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <button id="createCurve" class="reset-button" style="background: #ed8936;">创建弯道</button>
                        <button id="cancelCurve" class="reset-button" style="background: #a0aec0; display: none;">取消弯道</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <button id="showAllRoads" class="reset-button" style="background: #4299e1;">显示所有道路</button>
                        <button id="hideAllRoads" class="reset-button" style="background: #a0aec0;">隐藏所有道路</button>
                    </div>
                </div>
            </div>
            -->
        </div>

        <!-- 帮助面板 - 已隐藏 -->
        <!--
        <div id="helpPanel" class="help-panel" style="display: none;">
            <div class="help-header">
                <h3>⌨️ 快捷键帮助</h3>
                <button id="closeHelp" class="close-help">×</button>
            </div>
            <div class="help-content">
                <div class="help-section">
                    <h4>🛣️ 道路绘制</h4>
                    <div class="help-item">
                        <kbd>Space</kbd>
                        <span>开始/结束绘制</span>
                    </div>
                    <div class="help-item">
                        <kbd>ESC</kbd>
                        <span>取消当前操作</span>
                    </div>
                    <div class="help-item">
                        <kbd>Ctrl+Z</kbd>
                        <span>撤销上一个点</span>
                    </div>
                    <div class="help-item">
                        <kbd>Delete</kbd>
                        <span>删除选中的点</span>
                    </div>
                </div>
                <div class="help-section">
                    <h4>🎯 视图控制</h4>
                    <div class="help-item">
                        <kbd>鼠标左键</kbd>
                        <span>添加路径点</span>
                    </div>
                    <div class="help-item">
                        <kbd>鼠标右键</kbd>
                        <span>旋转视图</span>
                    </div>
                    <div class="help-item">
                        <kbd>滚轮</kbd>
                        <span>缩放视图</span>
                    </div>
                </div>
                <div class="help-section">
                    <h4>🔧 编辑功能</h4>
                    <div class="help-item">
                        <kbd>拖拽</kbd>
                        <span>移动路径点</span>
                    </div>
                    <div class="help-item">
                        <kbd>双击</kbd>
                        <span>插入新点</span>
                    </div>
                </div>
            </div>
        </div>
        -->

        <!-- 导出/导入模态对话框 - 已隐藏 -->
        <!--
        <div id="exportModal" class="export-modal" style="display: none;">
            <div class="export-modal-content">
                <div class="export-modal-header">
                    <h2>💾 导出/导入地图</h2>
                    <button id="closeExportModal" class="close-export-modal">×</button>
                </div>
                
                <div class="export-modal-body">
                    <div class="export-section">
                        <h3>📤 导出地图</h3>
                        <div class="export-buttons">
                            <button id="exportOpenDrive" class="export-btn opendrive-btn">
                                <div class="btn-icon">🗺️</div>
                                <div class="btn-text">
                                    <div class="btn-title">导出 OpenDRIVE</div>
                                    <div class="btn-desc">标准 OpenDRIVE XML 格式</div>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="export-section">
                        <h3>📥 导入地图</h3>
                        <div class="import-area">
                            <div class="file-upload-large">
                                <input type="file" id="importOpenDrive" class="file-input" accept=".xodr,.xml" style="display: none;">
                                <label for="importOpenDrive" class="file-label-large">
                                    <div class="upload-icon">📁</div>
                                    <div class="upload-text">选择 OpenDRIVE 文件</div>
                                    <div class="upload-desc">支持 .xodr 和 .xml 格式</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="export-section">
                        <h3>📊 地图信息</h3>
                        <div class="info-cards">
                            <div class="info-card">
                                <div class="info-icon">🛣️</div>
                                <div class="info-content">
                                    <div class="info-label">道路数量</div>
                                    <div id="exportRoadsCount" class="info-value">0</div>
                                </div>
                            </div>
                            <div class="info-card">
                                <div class="info-icon">🚦</div>
                                <div class="info-content">
                                    <div class="info-label">交叉口数量</div>
                                    <div id="exportJunctionsCount" class="info-value">0</div>
                                </div>
                            </div>
                            <div class="info-card">
                                <div class="info-icon">📏</div>
                                <div class="info-content">
                                    <div class="info-label">总长度</div>
                                    <div id="exportTotalLength" class="info-value">0.0m</div>
                                </div>
                            </div>
                            <div class="info-card">
                                <div class="info-icon">⏰</div>
                                <div class="info-content">
                                    <div class="info-label">最后保存</div>
                                    <div id="exportLastSaved" class="info-value">从未</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="export-section">
                        <h3>🔧 操作</h3>
                        <div class="action-buttons">
                            <button id="refreshExportInfo" class="action-btn refresh-btn">🔄 刷新信息</button>
                            <button id="clearAllData" class="action-btn clear-btn">🗑️ 清空数据</button>
                        </div>
                        <div class="warning-text">
                            ⚠️ 清空数据将删除所有道路和交叉口，此操作不可撤销
                        </div>
                    </div>
                </div>
            </div>
        </div>
        -->
    </div>

    <!-- Three.js 本地文件 -->
    <script src="src/js/three.min.js"></script>
    <script src="src/js/OrbitControls.js"></script>
    <script src="src/js/PCDLoader.js"></script>
    
    <!-- 压缩库支持 -->
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
    
    <script>
        // 检查依赖是否加载完成的函数
        function checkDependencies() {
            const checks = [
                { name: 'THREE', obj: window.THREE },
                { name: 'OrbitControls', obj: window.THREE && THREE.OrbitControls },
                { name: 'PCDLoader', obj: window.THREE && THREE.PCDLoader },
                { name: 'pako', obj: window.pako }
            ];
            
            const missing = checks.filter(check => !check.obj).map(check => check.name);
            
            if (missing.length > 0) {
                console.log('等待依赖加载:', missing);
                return false;
            } else {
                console.log('✅ 所有依赖加载成功');
                return true;
            }
        }
        
        // 等待模块加载完成
        let checkCount = 0;
        const maxChecks = 50; // 最多检查5秒
        
        function waitForDependencies() {
            if (checkDependencies()) {
                // 依赖加载完成，可以初始化应用
                if (typeof window.initOpenDriveEditor === 'function') {
                    window.initOpenDriveEditor();
                }
                return;
            }
            
            checkCount++;
            if (checkCount < maxChecks) {
                setTimeout(waitForDependencies, 100); // 每100ms检查一次
            } else {
                // 超时，显示错误
                console.error('依赖加载超时');
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #ff4444;
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    text-align: center;
                    z-index: 10000;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                `;
                errorDiv.innerHTML = `
                    <h3>❌ 依赖加载失败</h3>
                    <p>点云查看器组件加载超时，请检查网络连接</p>
                    <button onclick="location.reload()" style="
                        background: white;
                        color: #ff4444;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        margin-top: 10px;
                        cursor: pointer;
                        font-weight: bold;
                    ">刷新页面</button>
                `;
                document.body.appendChild(errorDiv);
            }
        }
        
        // 页面加载完成后开始检查
        window.addEventListener('load', waitForDependencies);
    </script>
    
    <script src="src/opendrive-editor.js"></script>
</body>
</html>
